<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ITER College - Sign Up</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    .theme-switcher {
      position: fixed;
      top: 20px;
      right: 20px;
      cursor: pointer;
      font-size: 1.5rem;
      z-index: 1000;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .signup-container {
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      padding: 30px;
      max-width: 600px;
      width: 100%;
    }
    
    body.dark-mode {
      background-color: #121212;
      color: #e0e0e0;
    }
    
    body.dark-mode .signup-container {
      background-color: rgba(33, 37, 41, 0.9);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    
    body.dark-mode .theme-switcher {
      background: #2d2d2d;
      border-color: #444;
      color: #e0e0e0;
    }
    
    body.dark-mode .form-control,
    body.dark-mode .form-select {
      background-color: #343a40;
      border-color: #495057;
      color: #f8f9fa;
    }
    
    body.dark-mode .input-group-text {
      background-color: #343a40;
      color: #f8f9fa;
      border-color: #495057;
    }
  </style>
</head>
<body>
  <div class="theme-switcher">
    <i class="fas fa-sun"></i>
  </div>
  <div class="container d-flex justify-content-center align-items-center min-vh-100 py-5">
    <div class="signup-container">
      <div class="text-center mb-4">
        <h1 class="mb-1">ITER College Portal</h1>
        <p>Institute of Technical Education and Research</p>
      </div>
      <h2 class="text-center mb-4 pb-2 border-bottom border-primary">Create an Account</h2>
      
      <div class="d-flex justify-content-center gap-3 mb-4">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="userType" id="userTypeStudent" value="student" checked>
          <label class="form-check-label" for="userTypeStudent">Student</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="userType" id="userTypeTeacher" value="teacher">
          <label class="form-check-label" for="userTypeTeacher">Teacher</label>
        </div>
      </div>
      
      <form id="signupForm">
        <div class="row mb-3">
          <div class="col-md-12">
            <div class="input-group">
              <span class="input-group-text"><i class="fas fa-user"></i></span>
              <input type="text" id="name" class="form-control" placeholder="Full Name *" required>
            </div>
          </div>
        </div>
        
        <div class="row mb-3">
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text"><i class="fas fa-id-card"></i></span>
              <input type="text" id="registerNo" class="form-control" placeholder="Registration Number *" required>
            </div>
          </div>
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text"><i class="fas fa-graduation-cap"></i></span>
              <select id="department" class="form-select" required>
                <option value="">Select Department *</option>
                <option value="CSE">Computer Science & Engineering</option>
                <option value="ECE">Electronics & Communication</option>
                <option value="EEE">Electrical & Electronics</option>
                <option value="MECH">Mechanical Engineering</option>
                <option value="CIVIL">Civil Engineering</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="row mb-3">
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text"><i class="fas fa-envelope"></i></span>
              <input type="email" id="email" class="form-control" placeholder="Email Address *" required>
            </div>
          </div>
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text"><i class="fas fa-phone"></i></span>
              <input type="tel" id="phone" class="form-control" placeholder="Phone Number *" pattern="[0-9]{10}" required>
            </div>
          </div>
        </div>
        
        <div class="row mb-3">
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text"><i class="fas fa-lock"></i></span>
              <input type="password" id="password" class="form-control" placeholder="Password *" minlength="6" required>
              <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text"><i class="fas fa-lock"></i></span>
              <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm Password *" required>
              <button class="btn btn-outline-secondary" type="button" id="toggleConfirmPassword">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>
        </div>
        
        <div class="alert alert-info">
          <small><i class="fas fa-info-circle me-1"></i> All fields marked with * are required</small>
        </div>
        
        <button type="submit" class="btn btn-primary w-100 mt-3">
          Sign Up <i class="fas fa-arrow-right ms-2"></i>
        </button>
      </form>
      
      <div id="errorMessage" class="alert alert-danger mt-3" style="display: none;"></div>
      <a href="./login.html" class="d-block text-center mt-3 text-primary text-decoration-none">
        <i class="fas fa-sign-in-alt me-2"></i> Already have an account? Login
      </a>
      <a href="./index.html" class="d-block text-center mt-2 text-primary text-decoration-none">
        <i class="fas fa-home me-2"></i> Back to Home
      </a>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Theme switcher
    const themeSwitcher = document.querySelector('.theme-switcher');
    const icon = themeSwitcher.querySelector('i');
    
    const isDarkMode = localStorage.getItem('darkMode') === 'true';
    if (isDarkMode) {
      document.body.classList.add('dark-mode');
      icon.classList.remove('fa-sun');
      icon.classList.add('fa-moon');
    }
    
    themeSwitcher.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      localStorage.setItem('darkMode', isDark);
      
      if (isDark) {
        icon.classList.remove('fa-sun');
        icon.classList.add('fa-moon');
      } else {
        icon.classList.remove('fa-moon');
        icon.classList.add('fa-sun');
      }
    });

    // Password toggle functionality
    document.getElementById('togglePassword').addEventListener('click', function() {
      const passwordField = document.getElementById('password');
      const toggleIcon = this.querySelector('i');
      
      if (passwordField.type === 'password') {
        passwordField.type = 'text';
        toggleIcon.classList.remove('fa-eye');
        toggleIcon.classList.add('fa-eye-slash');
      } else {
        passwordField.type = 'password';
        toggleIcon.classList.remove('fa-eye-slash');
        toggleIcon.classList.add('fa-eye');
      }
    });

    document.getElementById('toggleConfirmPassword').addEventListener('click', function() {
      const confirmPasswordField = document.getElementById('confirmPassword');
      const toggleIcon = this.querySelector('i');
      
      if (confirmPasswordField.type === 'password') {
        confirmPasswordField.type = 'text';
        toggleIcon.classList.remove('fa-eye');
        toggleIcon.classList.add('fa-eye-slash');
      } else {
        confirmPasswordField.type = 'password';
        toggleIcon.classList.remove('fa-eye-slash');
        toggleIcon.classList.add('fa-eye');
      }
    });
    
    // Signup functionality
    document.getElementById('signupForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const errorMessageDiv = document.getElementById('errorMessage');
      errorMessageDiv.style.display = 'none';

      // Get all form values
      const userType = document.querySelector('input[name="userType"]:checked').value;
      const name = document.getElementById('name').value.trim();
      const registerNo = document.getElementById('registerNo').value.trim();
      const department = document.getElementById('department').value;
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;

      // Validate all fields are filled
      if (!name || !registerNo || !department || !email || !phone || !password || !confirmPassword) {
        errorMessageDiv.textContent = 'Please fill in all required fields.';
        errorMessageDiv.style.display = 'block';
        return;
      }

      // Validate phone number format (10 digits)
      const phoneRegex = /^[0-9]{10}$/;
      if (!phoneRegex.test(phone)) {
        errorMessageDiv.textContent = 'Please enter a valid 10-digit phone number.';
        errorMessageDiv.style.display = 'block';
        return;
      }

      // Validate password match
      if (password !== confirmPassword) {
        errorMessageDiv.textContent = 'Passwords do not match.';
        errorMessageDiv.style.display = 'block';
        return;
      }

      // Validate password strength
      if (password.length < 6) {
        errorMessageDiv.textContent = 'Password must be at least 6 characters long.';
        errorMessageDiv.style.display = 'block';
        return;
      }

      const userData = {
        name,
        registerNo,
        department,
        email,
        phone,
        password,
        userType
      };

      try {
        const response = await fetch('http://localhost:5000/api/auth/signup', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(userData),
        });

        const data = await response.json();

        if (response.ok) {
          alert('Registration successful! Please login with your credentials.');
          window.location.href = './login.html';
        } else {
          // Handle specific error for duplicate registration number
          if (data.error.includes('already exists') || data.error.includes('duplicate')) {
            errorMessageDiv.textContent = 'Registration number already exists. Please use a different registration number.';
          } else {
            errorMessageDiv.textContent = data.error || 'Signup failed. Please try again.';
          }
          errorMessageDiv.style.display = 'block';
        }
      } catch (error) {
        errorMessageDiv.textContent = 'Server error. Please try again later.';
        errorMessageDiv.style.display = 'block';
      }
    });
  </script>
</body>
</html>